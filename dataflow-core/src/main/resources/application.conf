# ============================================
# DataFlow Platform - Core Library Configuration
# ============================================
# Minimal configuration for the domain/core library
# The application module (dataflow-api) provides cluster and Cassandra config

# ============================================
# DOMAIN CONFIGURATION
# ============================================
dataflow {
  # Application name
  system-name = "DataflowPlatform"

  # Pipeline settings
  pipeline {
    # Default batch size for ingestion
    default-batch-size = 1000

    # Maximum concurrent pipelines per node
    max-pipelines = 100

    # Checkpoint frequency
    checkpoint-interval = 10 seconds
  }
}

pekko {
  # Logging configuration
  loglevel = "INFO"
  loglevel = ${?PEKKO_LOG_LEVEL}

  log-config-on-start = off
  log-dead-letters = 10
  log-dead-letters-during-shutdown = off

  # ============================================
  # ACTOR SYSTEM (LIBRARY MODE)
  # ============================================
  actor {
    # Warn about java serialization
    warn-about-java-serializer-usage = on
    allow-java-serialization = off

    # Serialization configuration
    serializers {
      jackson-json = "org.apache.pekko.serialization.jackson.JacksonJsonSerializer"
      jackson-cbor = "org.apache.pekko.serialization.jackson.JacksonCborSerializer"
    }

    serialization-bindings {
      "com.dataflow.serialization.CborSerializable" = jackson-cbor
    }

    debug {
      receive = off
      lifecycle = off
      unhandled = on
    }
  }

  # ============================================
  # PERSISTENCE CONFIGURATION (PLUGIN SELECTION ONLY)
  # ============================================
  # Core module only declares WHICH plugins to use
  # Application module (dataflow-api) provides connection details
  persistence {
    journal {
      plugin = "pekko.persistence.cassandra.journal"
    }

    snapshot-store {
      plugin = "pekko.persistence.cassandra.snapshot"
    }

    # At-least-once delivery settings
    at-least-once-delivery {
      redeliver-interval = 5s
      redelivery-burst-limit = 10000
      warn-after-number-of-unconfirmed-attempts = 5
      max-unconfirmed-messages = 100000
    }

    # Failure recovery settings
    recovery {
      max-events-per-batch = 1000
    }
  }
}

# ============================================
# NOTE: Cluster and Cassandra Configuration
# ============================================
# This is a LIBRARY module, not an application!
#
# Cluster configuration (remote.artery, seed-nodes) is in:
#   - dataflow-api/src/main/resources/application.conf
#
# Cassandra connection details (contact-points, keyspaces) are in:
#   - dataflow-api/src/main/resources/application.conf
#
# This separation ensures:
#   - dataflow-core can be used as a library
#   - No cluster dependencies in core
#   - Application controls deployment configuration
